<html>
<head>

<meta charset="utf-8">
<title>Graphics Canvas</title>

<script type="module" src="./api/canvas-api.mjs"></script>
<script type="module" src="./api/editor-api.mjs"></script>
<script type="module" src="./api/menu-api.mjs"></script>
<script type="module" src="./api/test-api.mjs"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Emoji:wght@300..700&display=swap" rel="stylesheet">

<style>
    @import url("http://aloralyn.org:4242/style/wbrd/lemon.css");
    @import url("style/canvas-style.css");
    #sip {
        margin   : 0;
        border   : 0;
        padding  : 1.42ch;
        display  : block;
        position : fixed;
        top    : 0;
        left   : 0;
        width  : calc( 100% - 0px );
        resize : vertical;
        overflow-x  : scroll;
        overflow-y  : auto;
        font-family : "Noto Sans Mono", monospace;
        white-space : nowrap;
        z-index     : 424242;
    }
    #sip:focus {
        outline : none;
    }
    canvas {
        margin       : 1px;
        margin-top   : 4px;
        border   : 0;
        display  : block;
        position : fixed;
        top    : 0;
        left   : 0;
    }
</style>


<link rel="stylesheet" href="style/canvas-style.css">

<script>

function main() {
    if (! detectThor() ) { loadThor(); }
}

addEventListener( 'load', main );
</script>

<script>
function detectThor() {
    return ( "function" === typeof thor );
}
</script>
</head>

<body>

<script>

const ThorURLs = [
"http://dave-pi/festus/Q/api/thor.js" ,
"http://dave-lenovo/festus/Q/api/thor.js" ,
"http://dave-probook/festus/Q/api/thor.js" ,
"http://dave-legacy/festus/Q/api/thor.js" ,
"http://dave-zombie/festus/Q/api/thor.js" ,
"http://dave-ryzen/festus/Q/api/thor.js" ,
"http://dave-tower/festus/Q/api/thor.js" ,
"http://dave-omega/festus/Q/api/thor.js" ,
"http://aloralyn.org:4242/42m/core/api/thor.js" ,
"https://nyteowldave.work/greystoke/api/thor.js" ,
"https://nyteowldave.github.io/chachi/api/thor.js"
];

function loadThor() {
    try {
        if (! ThorURLs.length ) {
            throw new Error( "Unabled to load Thor Module" );
        }
        if ( "function" === typeof thor ) {
            return;
        }
        loadModule( ThorURLs.pop(), "idThor" );
    } catch ( e ) {
        console.error( e );
        // window.location = "./(404)";
    }
}

let loading;
function loadModule( url, id ) {
    function failed( payload ) {
        console.error( payload );
        if ( id === "idThor" ) { loadThor(); }
    }
    function loaded( payload ) {
        console.log( "Found module @ ", loading );
        const parts = loading.split( "/" );
        parts.pop();
        const url = parts.join( "/" )            
        coreModule( url );       
    }
    let se = document.getElementById( id );
    if ( se ) { se.remove(); }
    se = document.createElement( 'script' );
    se.id = id;
    document.head.appendChild( se );
    se.onload  = loaded;
    se.onerror = failed;
    loading = se.src = url;
    console.log( "Requesting", se.src );
}

let coreModules = [ "tigg", "legends", "joni" ];

function coreModule( url ) {
    const mod = coreModules.pop();
    if (! mod ) return false;
    url = `${url}/${mod}.js`;
    loadModule( url );
}

</script>



<textarea id="sip" wrap="off" rows="16">
    Welcome!
</textarea>

<script id="importedSIP">

st = sip.style;
st.fontSize = "18pt";
// st.width    = "1140px";

sip.eval = function() {
   console.log( "Evaluating SIP ..." );
   return sip.output = window.eval( sip.value );
}

ProjectDetails = {
  title  : "Graphics Canvas" ,
  host   : "dave-omega" ,
  home   : location.href ,
  tikey  : "c1c42985-894e-4757-83c1-dfe4e9a13e3a" ,
  tidate : "2025-JUL-30"
};

Remarks = `

This window needs to remain open.

I'm developing code for this app in the Debug Console.

I need to capture that code and save it to the Workspace!!!

`;

eraseCanvas = function( color = 'black' ) {
   ctx = canvas.ctx = canvas.getContext( '2d' );
   let w = canvas.width;
   let h = canvas.height;
   ctx.fillStyle = color;
   ctx.fillRect( 0, 0, w, h );
   return { w, h, ctx, canvas, color };
}

hasCanvas = function() {
    canvas = window.canvas = document.body.querySelector( 'canvas' );
    return (!! canvas );
}

removeCanvas = function() {
    if ( hasCanvas() ) {
        canvas.remove();
        window.canvas = undefined;
    }
}

createCanvas = function() {
    const body = document.body;
    removeCanvas();
    canvas = document.createElement( 'canvas' );
    body.appendChild( canvas );
    canvas.id = 'canvas';
    canvas.erase = eraseCanvas;
    canvas.width  = screen.availWidth  - 2;
    canvas.height = screen.availHeight - 6;
    canvas.style.border = "1px dotted gold";
    body.style.width = canvas.width + "px";
    return ( window.canvas = canvas );
}

</script>

<script>

function main() {
    try {
        createCanvas();
        sip.value = importedSIP.innerText;
        loadThor();
    } catch ( e ) { 
        console.error( e );
        alert( e );
    }
}

function moveCanvasTop() {
    let cs = getComputedStyle( sip );
    // let top = cs.height;
    canvas.style.top = cs.height;
}

addEventListener( 'load', main );

setInterval( moveCanvasTop, 342 );

</script>

</body>
</html>
